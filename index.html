<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pip-Boy Mod Garage</title>
    <!-- MediaPipe Â∫ì -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <!-- Â§çÂè§Â≠ó‰Ωì & ÂõæÊ†á -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- 0. ÂÖ®Â±ÄÂèòÈáè --- */
        :root {
            --pip-green: #1eff00;
            --pip-dim: #0f4d00;
            --pip-bg: #050505;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--pip-bg);
            color: var(--pip-green);
            font-family: 'VT323', monospace;
            margin: 0; overflow: hidden; height: 100vh;
            user-select: none; cursor: none;
        }

        /* --- 1. ÁâπÊïàÂ±Ç --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 6px 100%; pointer-events: none; z-index: 9000; opacity: 0.5;
        }
        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.8); pointer-events: none; z-index: 9001;
        }

        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #boot-text { font-size: 30px; animation: blink 1s infinite; text-align: center; }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- 2. ÂÖâÊ†á --- */
        #cursor {
            position: fixed; width: 20px; height: 20px;
            border: 2px solid var(--pip-green); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none;
            z-index: 2147483647; box-shadow: 0 0 10px var(--pip-green);
            transition: width 0.1s, height 0.1s;
        }
        #cursor::before { content:''; position:absolute; top:8px; left:-8px; width:36px; height:2px; background:var(--pip-green); opacity: 0.6; }
        #cursor::after { content:''; position:absolute; left:8px; top:-8px; width:2px; height:36px; background:var(--pip-green); opacity: 0.6; }
        #cursor.clicking { background: var(--pip-green); width: 12px; height: 12px; box-shadow: 0 0 20px #fff; }

        /* --- 3. Â∏ÉÂ±Ä --- */
        .container {
            display: grid; grid-template-rows: 70px 1fr;
            height: 100vh; max-width: 1600px; margin: 0 auto;
            border-left: 2px solid var(--pip-dim); border-right: 2px solid var(--pip-dim);
        }

        header {
            border-bottom: 2px solid var(--pip-green);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; background: rgba(0, 20, 0, 0.95); z-index: 50;
        }

        .user-status-area { display: flex; align-items: center; gap: 20px; }
        .login-btn-top {
            border: 1px solid var(--pip-green); padding: 5px 20px;
            font-size: 20px; color: var(--pip-green);
            transition: 0.2s; font-family: 'VT323';
        }
        .login-btn-top.hovered { background: var(--pip-green); color: #000; box-shadow: 0 0 10px var(--pip-green); }
        .user-label { display: none; font-size: 18px; color: var(--pip-dim); }
        .user-label.active { display: block; }

        .main-body {
            display: grid; grid-template-columns: 220px 1fr;
            overflow: hidden; position: relative;
        }

        /* ‰æßËæπÊ†è */
        nav {
            border-right: 2px solid var(--pip-green); padding: 20px;
            display: flex; flex-direction: column; gap: 10px; background: rgba(0, 10, 0, 0.8);
        }
        .nav-btn {
            background: transparent; border: 1px solid var(--pip-dim);
            color: var(--pip-dim); padding: 12px; font-size: 22px;
            text-align: left; transition: 0.2s; font-family: 'VT323';
        }
        .nav-btn.active, .nav-btn.hovered {
            border-color: var(--pip-green); color: var(--pip-green);
            background: rgba(30, 255, 0, 0.1); text-shadow: 0 0 5px var(--pip-green);
        }
        .nav-btn-new { border: 1px dashed var(--pip-green); margin-bottom: 20px; text-align: center; }

        /* ÂÜÖÂÆπÂå∫ */
        #content-area { position: relative; height: 100%; overflow: hidden; background: rgba(0,0,0,0.3); }

        .scroll-controls {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 40px; z-index: 8000;
            background: rgba(0, 0, 0, 0.9); padding: 5px 30px;
            border: 1px solid var(--pip-dim); border-radius: 30px;
        }
        .scroll-btn {
            width: 50px; height: 50px; border: 2px solid var(--pip-green); border-radius: 50%;
            background: #000; color: var(--pip-green); font-size: 24px;
            display: flex; align-items: center; justify-content: center;
        }
        .scroll-btn.active-scroll, .scroll-btn.hovered { background: var(--pip-green); color: #000; }

        /* ÂàóË°®ËßÜÂõæ */
        #list-view { padding: 80px 40px 100px 40px; height: 100%; overflow-y: auto; }
        ::-webkit-scrollbar { display: none; }

        /* ÊéíÂ∫èÊ†èÊ†∑Âºè */
        .sort-bar {
            display: flex; gap: 20px; margin-bottom: 20px; 
            border-bottom: 1px dashed var(--pip-dim); padding-bottom: 10px;
            align-items: center;
        }
        .sort-label { color: var(--pip-dim); font-size: 20px; }
        .sort-btn { 
            cursor: pointer; padding: 5px 10px; border: 1px solid transparent; 
            color: var(--pip-dim); transition: 0.2s; font-size: 20px;
        }
        .sort-btn.active { color: var(--pip-green); border: 1px solid var(--pip-green); background: rgba(30, 255, 0, 0.1); }
        .sort-btn.hovered { color: #fff; text-shadow: 0 0 5px var(--pip-green); }

        .post-card {
            display: flex; border: 1px solid var(--pip-dim); margin-bottom: 20px;
            background: rgba(0, 20, 0, 0.6); transition: 0.2s; height: 130px;
            position: relative;
        }
        .post-card.hovered { border-color: var(--pip-green); box-shadow: 0 0 15px var(--pip-dim); }
        .post-thumb {
            width: 160px; height: 100%; object-fit: cover; border-right: 1px solid var(--pip-dim);
            filter: grayscale(100%) sepia(100%) hue-rotate(80deg) saturate(200%) contrast(1.2);
        }
        .post-info { padding: 15px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .post-title { font-size: 24px; font-weight: bold; color: var(--pip-green); margin-bottom: 5px; }

        .btn-like {
            display: inline-flex; align-items: center; gap: 8px;
            border: 1px solid var(--pip-dim); padding: 5px 10px;
            font-size: 18px; color: var(--pip-dim); width: fit-content; margin-top: 5px; transition: 0.2s;
        }
        .btn-like.liked { border-color: var(--pip-green); background: var(--pip-green); color: #000; }
        .btn-like.hovered { border-color: var(--pip-green); color: var(--pip-green); }
        .btn-like.liked.hovered { background: #fff; }

        .avatar {
            width: 40px; height: 40px; border: 1px solid var(--pip-green);
            background: #000; margin-right: 10px; flex-shrink: 0;
            filter: sepia(100%) hue-rotate(50deg) saturate(300%);
        }
        .avatar.hovered { transform: scale(1.1); box-shadow: 0 0 10px var(--pip-green); border-color: #fff; }

        /* --- 4. ËØ¶ÊÉÖÈ°µ --- */
        #detail-view {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 10, 5, 0.98); z-index: 100;
            padding: 80px 50px 100px 50px; overflow-y: auto;
        }
        .back-btn {
            display: inline-block; border: 1px solid var(--pip-green); padding: 5px 20px;
            margin-bottom: 20px; font-size: 20px; background: #000;
        }
        .back-btn.hovered { background: var(--pip-green); color: #000; }
        .detail-img-full {
            width: 100%; max-height: 400px; object-fit: cover; border: 2px solid var(--pip-dim);
            margin-bottom: 20px; filter: grayscale(100%) sepia(100%) hue-rotate(80deg) saturate(200%);
        }
        .detail-body { font-size: 22px; line-height: 1.6; margin-bottom: 40px; border-left: 4px solid var(--pip-dim); padding-left: 20px; white-space: pre-wrap; }

        /* ËØÑËÆ∫Ê†∑Âºè */
        .comment-node { margin-bottom: 20px; }
        .comment-main { 
            border: 1px solid var(--pip-dim); padding: 15px; background: rgba(0, 30, 0, 0.3);
            display: flex; gap: 15px; align-items: flex-start;
        }
        /* ËØÑËÆ∫ÁÇπËµûÊåâÈíÆÊ†∑Âºè (New in V12) */
        .btn-comment-like {
            cursor: pointer; border: 1px solid var(--pip-dim); padding: 2px 8px;
            font-size: 16px; color: var(--pip-dim); transition: 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-comment-like.liked { border-color: var(--pip-green); background: var(--pip-green); color: #000; }
        .btn-comment-like.hovered { border-color: var(--pip-green); color: var(--pip-green); }
        .btn-comment-like.liked.hovered { background: #fff; }

        .comment-input-area {
            border: 1px solid var(--pip-green); padding: 15px; margin-bottom: 30px;
            background: rgba(0, 20, 0, 0.5);
        }
        .emoji-quick-btn { font-size: 24px; padding: 5px; cursor: pointer; border: 1px solid transparent; }
        .emoji-quick-btn.hovered { border-color: var(--pip-green); background: rgba(30, 255, 0, 0.2); }

        /* --- 5. Ê®°ÊÄÅÊ°Ü --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); z-index: 20000;
            align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal-box {
            width: 600px; border: 2px solid var(--pip-green); background: #050505;
            padding: 30px; position: relative; box-shadow: 0 0 30px var(--pip-dim);
        }
        .modal-close { position: absolute; top: 10px; right: 15px; font-size: 30px; }
        .modal-close.hovered { color: #fff; }

        .form-input, .form-textarea {
            width: 100%; background: #000; border: 1px solid var(--pip-dim);
            color: var(--pip-green); font-family: 'VT323'; font-size: 24px; padding: 10px; margin-bottom: 15px;
        }
        .form-textarea { height: 150px; resize: none; }
        .form-input.hovered, .form-textarea.hovered { border-color: var(--pip-green); background: #001100; }
        
        .btn-action {
            width: 100%; background: var(--pip-dim); color: #fff; border: none;
            padding: 15px; font-size: 24px; font-family: 'VT323'; margin-bottom: 10px;
        }
        .btn-action.hovered { background: var(--pip-green); color: #000; }

        .post-toolbar { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--pip-dim); padding-bottom: 10px; position: relative; }
        .toolbar-btn {
            border: 1px solid var(--pip-dim); padding: 5px 15px; font-size: 20px; color: var(--pip-dim);
        }
        .toolbar-btn.hovered { color: var(--pip-green); border-color: var(--pip-green); }

        #emoji-grid {
            display: none; position: absolute; top: 50px; left: 0; 
            background: #000; border: 1px solid var(--pip-green); padding: 10px;
            grid-template-columns: repeat(5, 1fr); gap: 5px; z-index: 5000;
        }
        .emoji-item { font-size: 24px; cursor: pointer; padding: 5px; }
        .emoji-item.hovered { background: var(--pip-green); }

        .social-btn {
            flex: 1; border: 1px solid var(--pip-dim); padding: 10px;
            text-align: center; color: var(--pip-dim); font-size: 20px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .social-btn.hovered { border-color: var(--pip-green); color: var(--pip-green); }

        #user-tooltip {
            display: none; position: fixed; width: 300px; 
            background: #000; border: 2px solid var(--pip-green);
            padding: 15px; z-index: 99999; pointer-events: none;
        }

        .input_video { display: none; }
        #real-file-input { display: none; }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="crt-overlay"></div>
    <div id="cursor"></div>
    <video class="input_video"></video>
    <input type="file" id="real-file-input">

    <div id="boot-screen">
        <div id="boot-text">
            > PIP-BOY MOD GARAGE<br>
            > LINKING...<br><br>
            [ CLICK TO INITIALIZE ]
        </div>
    </div>

    <div id="user-tooltip">
        <div style="border-bottom:1px solid var(--pip-dim); margin-bottom:5px;">USER DATA</div>
        <div id="tt-content"></div>
    </div>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-close" data-target="login-modal">√ó</div>
            <h2>IDENTITY VERIFICATION</h2>
            <input type="text" class="form-input" placeholder="PIP-BOY ID" value="The_Survivor">
            <input type="password" class="form-input" placeholder="PASSPHRASE" value="*******">
            <button class="btn-action" id="btn-login-submit">AUTHENTICATE</button>
            <div style="display:flex; gap:10px;">
                <div class="social-btn"><i class="fab fa-google"></i> GOOGLE</div>
                <div class="social-btn"><i class="fab fa-facebook-f"></i> FACEBOOK</div>
                <div class="social-btn"><i class="fab fa-apple"></i> APPLE</div>
            </div>
        </div>
    </div>

    <div id="post-modal" class="modal-overlay">
        <div class="modal-box" style="width: 700px;">
            <div class="modal-close" data-target="post-modal">√ó</div>
            <h2>TRANSMIT NEW ENTRY</h2>
            <input type="text" class="form-input" id="post-title" placeholder="SUBJECT LINE (PINCH TO AUTO-FILL)">
            <div class="post-toolbar">
                <div class="toolbar-btn" data-type="file"><i class="fas fa-image"></i> IMG</div>
                <div class="toolbar-btn" data-type="file"><i class="fas fa-video"></i> VID</div>
                <div class="toolbar-btn" data-type="file"><i class="fas fa-paperclip"></i> ATT</div>
                <div class="toolbar-btn" id="btn-emoji"><i class="far fa-smile"></i> EMOJI</div>
                <div id="emoji-grid">
                    <div class="emoji-item">‚ò¢Ô∏è</div><div class="emoji-item">üëç</div><div class="emoji-item">üíÄ</div><div class="emoji-item">üí©</div><div class="emoji-item">üî´</div>
                    <div class="emoji-item">ü§ñ</div><div class="emoji-item">üíä</div><div class="emoji-item">üí£</div><div class="emoji-item">üõ†Ô∏è</div><div class="emoji-item">üëΩ</div>
                </div>
            </div>
            <textarea class="form-textarea" id="post-body" placeholder="ENTER MESSAGE DATA... (PINCH TO AUTO-FILL)"></textarea>
            <button class="btn-action" id="btn-post-submit">TRANSMIT DATA</button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>PIP-BOY MOD GARAGE</h1>
            <div class="user-status-area">
                <div class="user-label" id="header-username">USER: VAULT_DWELLER</div>
                <div class="login-btn-top" id="btn-auth">LOGIN / SIGNUP</div>
            </div>
        </header>

        <div class="main-body">
            <nav>
                <div class="nav-btn nav-btn-new" id="btn-open-post">[+] NEW_ENTRY</div>
                <div class="nav-btn active" data-cat="ALL">LATEST_FEED</div>
                <div class="nav-btn" data-cat="DISCUSSION">DISCUSSIONS</div>
                <div class="nav-btn" data-cat="MOD_REL">MOD_RELEASES</div>
                <div class="nav-btn" data-cat="HELP">TECH_SUPPORT</div>
                <div class="nav-btn" data-cat="OFF_TOPIC">WASTELAND_CHAT</div>
            </nav>

            <div id="content-area">
                <div class="scroll-controls">
                    <div class="scroll-btn" id="scroll-up">‚ñ≤</div>
                    <div class="scroll-btn" id="scroll-down">‚ñº</div>
                </div>

                <div id="list-view"></div>

                <div id="detail-view">
                    <div class="back-btn" id="btn-back"> < BACK </div>
                    <div id="detail-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const AudioSys = {
            ctx: null,
            init: function() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.ctx.resume();
                }
            },
            play: function(freq, type, dur, vol = 0.1) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type; osc.frequency.value = freq;
                gain.gain.value = vol; gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + dur);
            },
            hover: function() { this.play(800, 'sine', 0.05, 0.05); },
            click: function() { this.play(300, 'square', 0.08, 0.1); },
            type: function() { this.play(600 + Math.random()*200, 'triangle', 0.05, 0.05); },
            success: function() { this.play(400, 'square', 0.1, 0.1); setTimeout(() => this.play(600, 'square', 0.1, 0.1), 100); },
            logout: function() { this.play(300, 'sawtooth', 0.3, 0.2); setTimeout(() => this.play(100, 'sawtooth', 0.4, 0.2), 200); },
            upload: function() { const now = this.ctx.currentTime; for(let i=0; i<10; i++) setTimeout(() => this.play(1000 + Math.random()*1000, 'square', 0.05, 0.05), i*50); }
        };

        const State = {
            isLoggedIn: false,
            currentUser: { name: "Guest", avatar: "" },
            posts: [],
            postSortMode: 'TIME',
            commSortMode: 'TIME'
        };

        document.getElementById('boot-screen').addEventListener('click', function() {
            AudioSys.init(); AudioSys.success(); this.style.display = 'none';
        });

        const userPrefix = ["Nuka", "Vault", "Deathclaw", "Radioactive", "Piper", "Ghoul", "Plasma", "Laser"];
        const userSuffix = ["Slayer", "Survivor", "Lover", "Fan69", "Master", "King", "Enjoyer", "_Official"];

        const rawContent = [
            { cat: "HELP", title: "MY GAME KEEPS CRASHING IN BOSTON!!!", body: "Every time I walk near Swan's Pond, CTD. I have 400 mods installed. Is it the 8k spoon texture mod? Please help, I'm losing my mind.", reply: "Post your load order or we can't help you." },
            { cat: "MOD_REL", title: "[Release] Thomas the Tank Engine Deathclaws V2", body: "Updated the mesh. Now with 400% more distinct whistle sounds. Immersive? No. Terrifying? Yes.", reply: "This is why the bombs dropped." },
            { cat: "DISCUSSION", title: "Unpopular Opinion: Preston isn't that bad", body: "Hear me out. He just wants to help people. The radiant quests are annoying but the guy has a heart of gold.", reply: "Another settlement needs your help. I'll mark it on your map." },
            { cat: "HELP", title: "Purple textures everywhere?", body: "I installed CBBE and now everyone has purple skin. What did I do wrong? I'm using Vortex.", reply: "You missed the texture archive. Reinstall it properly." },
            { cat: "MOD_REL", title: "Realistic Rust Overhaul 4K", body: "Replaces all rust textures with high-res photos I took at a local junkyard. 4GB VRAM required minimum.", reply: "My GPU is crying just looking at the screenshots." },
            { cat: "OFF_TOPIC", title: "Just found a teddy bear reading a newspaper", body: "Bethesda environmental storytelling is top tier. Found this in a subway toilet. Anyone else find weird teddy bear setups?", reply: "Wait until you find the one with the handcuffs..." },
            { cat: "DISCUSSION", title: "New Vegas vs Fallout 4 - Let's argue", body: "NV has better writing, FO4 has better gunplay. Discuss.", reply: "Here we go again..." },
            { cat: "HELP", title: "Pip-Boy light not working", body: "Pressed Tab, nothing happens. Is my bulb broken? (Ingame obviously)", reply: "Did you hold the key? Long press for light." },
            { cat: "MOD_REL", title: "Immersive Toilet Paper (Correct Orientation)", body: "Fixes the game-breaking bug where TP rolls are facing the wall. Immersion saved.", reply: "It just works." },
            { cat: "OFF_TOPIC", title: "Ad Victoriam Brothers!", body: "Just joined the Brotherhood on my 5th playthrough. That airship entrance never gets old.", reply: "Institute for life. Better showers." }
        ];

        function getRandomUser() {
            const name = userPrefix[Math.floor(Math.random()*userPrefix.length)] + userSuffix[Math.floor(Math.random()*userSuffix.length)] + Math.floor(Math.random()*99);
            return {
                name: name,
                avatar: `https://api.dicebear.com/7.x/pixel-art/svg?seed=${name}`,
                faction: ["Brotherhood", "Institute", "Railroad", "Minutemen", "Raider"][Math.floor(Math.random()*5)],
                regDate: `20${Math.floor(Math.random()*10+15)}.${Math.floor(Math.random()*12+1)}`,
                karma: Math.random() > 0.5 ? "Good" : "Neutral"
            };
        }

        function initData() {
            for (let i = 0; i < 30; i++) {
                const template = rawContent[Math.floor(Math.random() * rawContent.length)];
                const author = getRandomUser();
                const commentCount = Math.floor(Math.random() * 4) + 1;
                const comments = [];
                for(let j=0; j<commentCount; j++) {
                    const cUser = getRandomUser();
                    const replies = [template.reply, "Endorsed!", "Works for me.", "Update plzzzz", "Can you make a patch for this?", "LMAO", "Delete this.", "War... war never changes."];
                    comments.push({
                        user: cUser,
                        text: replies[Math.floor(Math.random() * replies.length)],
                        likes: Math.floor(Math.random() * 50),
                        timestamp: Date.now() - Math.floor(Math.random() * 10000000),
                        id: Math.random(), // Unique ID for comment
                        isLiked: false
                    });
                }
                comments.sort((a,b) => b.timestamp - a.timestamp);

                State.posts.push({
                    id: Date.now() - Math.floor(Math.random() * 100000000),
                    category: template.cat,
                    title: template.title,
                    author: author,
                    likes: Math.floor(Math.random() * 5000) + 5,
                    isLiked: false,
                    image: `https://picsum.photos/seed/${i + 888}/600/300`,
                    content: template.body + "\n\n(Posted from Pip-Boy Mod Garage V12.0)",
                    comments: comments
                });
            }
            State.posts.sort((a,b) => b.id - a.id);
            renderList("ALL");
        }

        const listView = document.getElementById('list-view');
        const detailView = document.getElementById('detail-view');
        const detailContent = document.getElementById('detail-content');

        function renderList(cat) {
            let sortBarHtml = `
                <div class="sort-bar">
                    <span class="sort-label">SORT FEED:</span>
                    <span class="sort-btn post-sort-btn ${State.postSortMode==='TIME'?'active':''}" data-mode="TIME">[ TIME ]</span>
                    <span class="sort-btn post-sort-btn ${State.postSortMode==='HEAT'?'active':''}" data-mode="HEAT">[ HEAT ]</span>
                </div>
            `;
            
            let filtered = cat === "ALL" ? State.posts : State.posts.filter(p => p.category === cat);
            
            let displayPosts = [...filtered];
            if(State.postSortMode === 'TIME') {
                displayPosts.sort((a,b) => b.id - a.id);
            } else {
                displayPosts.sort((a,b) => b.likes - a.likes);
            }

            listView.innerHTML = sortBarHtml;
            
            displayPosts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post-card';
                div.dataset.id = post.id;
                const uStr = encodeURIComponent(JSON.stringify(post.author));
                div.innerHTML = `
                    <img src="${post.image}" class="post-thumb">
                    <div class="post-info">
                        <div class="post-title">${post.title}</div>
                        <div style="display:flex; justify-content:space-between; align-items:end;">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <img src="${post.author.avatar}" class="avatar" data-user="${uStr}">
                                <div style="color:var(--pip-dim)">${post.author.name}</div>
                            </div>
                            <div class="btn-like ${post.isLiked?'liked':''}" data-pid="${post.id}">
                                <i class="fas fa-thumbs-up"></i> <span class="like-num">${post.likes}</span>
                            </div>
                        </div>
                    </div>
                `;
                listView.appendChild(div);
            });
        }

        function showDetail(id) {
            const post = State.posts.find(p=>p.id == id);
            if(!post) return;
            const uStr = encodeURIComponent(JSON.stringify(post.author));
            
            let displayComments = [...post.comments];
            if(State.commSortMode === 'TIME') {
                displayComments.sort((a,b) => b.timestamp - a.timestamp);
            } else {
                displayComments.sort((a,b) => b.likes - a.likes);
            }

            let commentsHtml = displayComments.map(c => {
                const cStr = encodeURIComponent(JSON.stringify(c.user));
                return `
                <div class="comment-node">
                    <div class="comment-main">
                        <img src="${c.user.avatar}" class="avatar" data-user="${cStr}">
                        <div style="flex:1">
                            <div style="display:flex; justify-content:space-between;">
                                <span style="font-weight:bold;">${c.user.name}</span>
                                <!-- New Comment Like Button -->
                                <div class="btn-comment-like ${c.isLiked?'liked':''}" data-pid="${post.id}" data-cid="${c.id}">
                                    <i class="fas fa-thumbs-up"></i> <span class="c-like-num">${c.likes}</span>
                                </div>
                            </div>
                            <span style="opacity:0.9">${c.text}</span>
                        </div>
                    </div>
                </div>`;
            }).join('');

            let replyBoxHtml = '';
            if (State.isLoggedIn) {
                replyBoxHtml = `
                <div class="comment-input-area">
                    <div style="margin-bottom:10px; color:var(--pip-dim);">TRANSMIT A REPLY:</div>
                    <textarea id="comment-input" class="form-textarea" style="height:80px;" placeholder="ENTER TEXT... (PINCH TO AUTO-FILL)"></textarea>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span class="emoji-quick-btn" data-char="üëç">üëç</span>
                        <span class="emoji-quick-btn" data-char="‚ù§Ô∏è">‚ù§Ô∏è</span>
                        <span class="emoji-quick-btn" data-char="üòÇ">üòÇ</span>
                        <span class="emoji-quick-btn" data-char="üí©">üí©</span>
                        <span class="emoji-quick-btn" data-char="‚ò¢Ô∏è">‚ò¢Ô∏è</span>
                        <button class="btn-action" id="btn-submit-comment" style="width:auto; margin:0; margin-left:auto; padding:5px 20px;">SEND</button>
                    </div>
                </div>`;
            }

            let commSortHtml = `
                <div class="sort-bar" style="border-bottom:none; margin-bottom:10px; font-size:18px;">
                    <span class="sort-label">SORT COMMS:</span>
                    <span class="sort-btn comm-sort-btn ${State.commSortMode==='TIME'?'active':''}" data-mode="TIME">[ LATEST ]</span>
                    <span class="sort-btn comm-sort-btn ${State.commSortMode==='HEAT'?'active':''}" data-mode="HEAT">[ TOP ]</span>
                </div>
            `;

            detailContent.innerHTML = `
                <h2>${post.title}</h2>
                <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px; border-bottom:1px solid var(--pip-dim); padding-bottom:10px;">
                    <img src="${post.author.avatar}" class="avatar" style="width:60px;height:60px;" data-user="${uStr}">
                    <div><div>${post.author.name}</div><div style="color:var(--pip-dim)">${post.author.faction}</div></div>
                    <div class="btn-like ${post.isLiked?'liked':''}" data-pid="${post.id}" style="margin-left:auto; font-size:24px;">
                        [+] ENDORSE (<span class="like-num">${post.likes}</span>)
                    </div>
                </div>
                <img src="${post.image}" class="detail-img-full">
                <div class="detail-body">${post.content}</div>
                <h3>COMMUNICATIONS</h3>
                ${commSortHtml}
                ${replyBoxHtml}
                <div style="padding-bottom:100px;">${commentsHtml}</div>
            `;
            
            detailView.dataset.currentPostId = post.id;
            listView.style.display='none'; detailView.style.display='block';
        }

        initData();

        const cursor = document.getElementById('cursor');
        const loginModal = document.getElementById('login-modal');
        const postModal = document.getElementById('post-modal');
        const tooltip = document.getElementById('user-tooltip');
        const emojiGrid = document.getElementById('emoji-grid');
        const realFileInput = document.getElementById('real-file-input');

        const autoTitle = "Strange signal found near Sector 7...";
        const autoBody = "I was exploring the glowing sea yesterday and picked up a repeating radio signal. Attached are the frequency coordinates.";
        const autoComment = "Great find! I'll check it out tonight. Ad Victoriam.";

        let isPinching = false, isClickLock = false;
        let lastHovered = null;
        let scrollSpeed = 0, scrollDir = 0;

        function updateScroll() {
            if(scrollDir !== 0) {
                if(scrollSpeed < 20) scrollSpeed++;
                (detailView.style.display==='block' ? detailView : listView).scrollBy(0, scrollDir * scrollSpeed);
            } else scrollSpeed = 0;
            requestAnimationFrame(updateScroll);
        }
        updateScroll();

        function simulateTyping(element, text) {
            element.value = ""; let i = 0;
            const interval = setInterval(() => {
                element.value += text.charAt(i); AudioSys.type(); i++;
                if(i >= text.length) clearInterval(interval);
            }, 30);
        }

        function onResults(results) {
            if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) return;
            const lm = results.multiHandLandmarks[0];
            
            let mX = (1 - lm[8].x - 0.15) / 0.7; 
            let mY = (lm[8].y - 0.15) / 0.7;
            let cX = Math.max(0, Math.min(1, mX)) * window.innerWidth;
            let cY = Math.max(0, Math.min(1, mY)) * window.innerHeight;
            
            const currLeft = parseFloat(cursor.style.left||cX);
            const currTop = parseFloat(cursor.style.top||cY);
            cursor.style.left = (currLeft + (cX - currLeft)*0.3) + 'px';
            cursor.style.top = (currTop + (cY - currTop)*0.3) + 'px';

            cursor.style.display = 'none';
            const el = document.elementFromPoint(cX, cY);
            cursor.style.display = 'block';

            const interactive = el ? el.closest('.nav-btn, .post-card, .btn-action, .modal-close, .form-input, .form-textarea, .toolbar-btn, .login-btn-top, .avatar, .btn-like, .back-btn, .social-btn, .emoji-item, .emoji-quick-btn, .sort-btn, .btn-comment-like') : null;
            if(interactive && interactive !== lastHovered) {
                AudioSys.hover();
                document.querySelectorAll('.hovered').forEach(e=>e.classList.remove('hovered'));
                interactive.classList.add('hovered');
            } else if(!interactive) {
                document.querySelectorAll('.hovered').forEach(e=>e.classList.remove('hovered'));
            }
            lastHovered = interactive;

            if(el && el.classList.contains('avatar')) {
                try {
                    const u = JSON.parse(decodeURIComponent(el.dataset.user));
                    document.getElementById('tt-content').innerHTML = `ID: ${u.name}<br>Faction: ${u.faction}<br>Karma: ${u.karma}`;
                    tooltip.style.display = 'block'; tooltip.style.left=(cX+20)+'px'; tooltip.style.top=cY+'px';
                } catch(e){}
            } else tooltip.style.display = 'none';

            const dist = Math.hypot(lm[8].x - lm[4].x, lm[8].y - lm[4].y);
            if(dist < 0.05) {
                if(!isPinching) {
                    isPinching = true;
                    cursor.classList.add('clicking');
                    handleTap(el);
                }
            } else {
                isPinching = false;
                cursor.classList.remove('clicking');
                scrollDir = 0; document.querySelectorAll('.scroll-btn').forEach(b=>b.classList.remove('active-scroll'));
            }
        }

        function handleTap(el) {
            if(!el) return;
            AudioSys.click();

            const sBtn = el.closest('.scroll-btn');
            if(sBtn) { sBtn.classList.add('active-scroll'); scrollDir = sBtn.id==='scroll-up'?-1:1; return; }

            if(isClickLock) return;
            isClickLock = true; setTimeout(()=>isClickLock=false, 500);

            if(el.classList.contains('post-sort-btn')) {
                State.postSortMode = el.dataset.mode;
                const activeCat = document.querySelector('.nav-btn.active') ? document.querySelector('.nav-btn.active').dataset.cat : 'ALL';
                renderList(activeCat);
                return;
            }

            if(el.classList.contains('comm-sort-btn')) {
                State.commSortMode = el.dataset.mode;
                const currentId = document.getElementById('detail-view').dataset.currentPostId;
                if(currentId) showDetail(currentId);
                return;
            }

            if(el.closest('#btn-auth')) {
                if(State.isLoggedIn) {
                    State.isLoggedIn = false; AudioSys.logout();
                    document.getElementById('header-username').classList.remove('active');
                    document.getElementById('btn-auth').innerText = "LOGIN / SIGNUP";
                    alert("SYSTEM: LOGGING OFF...");
                } else {
                    loginModal.style.display = 'flex';
                }
                return;
            }

            if(el.closest('#btn-login-submit') || el.closest('.social-btn')) {
                const btn = el.closest('#btn-login-submit') || el.closest('.social-btn');
                btn.style.background = "#fff"; 
                setTimeout(() => {
                    State.isLoggedIn = true;
                    State.currentUser = getRandomUser();
                    State.currentUser.name = "Vault_Dweller";
                    AudioSys.success();
                    loginModal.style.display = 'none';
                    document.getElementById('header-username').innerText = "USER: VAULT_DWELLER";
                    document.getElementById('header-username').classList.add('active');
                    document.getElementById('btn-auth').innerText = "[ LOGOUT ]";
                    if(btn.id === 'btn-login-submit') btn.innerText = "AUTHENTICATE";
                    else btn.style.background = ""; 
                }, 800);
                return;
            }

            if(el.closest('#btn-open-post')) {
                if(!State.isLoggedIn) { alert("ACCESS DENIED. PLEASE LOGIN."); return; }
                postModal.style.display = 'flex';
                emojiGrid.style.display = 'none';
                return;
            }

            if(el.closest('.toolbar-btn') && el.closest('.toolbar-btn').dataset.type === 'file') {
                realFileInput.click();
                return;
            }

            if(el.closest('#btn-emoji')) {
                emojiGrid.style.display = emojiGrid.style.display === 'grid' ? 'none' : 'grid';
                return;
            }
            if(el.classList.contains('emoji-item')) {
                document.getElementById('post-body').value += el.innerText;
                return;
            }

            if(el.id === 'post-title') { simulateTyping(el, autoTitle); return; }
            if(el.id === 'post-body') { simulateTyping(el, autoBody); return; }

            if(el.closest('#btn-post-submit')) {
                const title = document.getElementById('post-title').value;
                if(!title) { alert("ERROR: NO DATA"); return; }
                AudioSys.upload();
                const newPost = {
                    id: Date.now(), category: "DISCUSSION", title: title,
                    author: State.currentUser, likes: 0, isLiked: false,
                    image: `https://picsum.photos/seed/${Date.now()}/500/300`,
                    content: document.getElementById('post-body').value || "No text data.", comments: []
                };
                State.posts.unshift(newPost);
                renderList("ALL");
                postModal.style.display = 'none';
                return;
            }

            if(el.id === 'comment-input') { simulateTyping(el, autoComment); return; }
            if(el.classList.contains('emoji-quick-btn')) {
                const box = document.getElementById('comment-input');
                if(box) box.value += el.dataset.char;
                return;
            }
            if(el.closest('#btn-submit-comment')) {
                const box = document.getElementById('comment-input');
                if(!box.value) return;
                AudioSys.upload();
                const currentId = document.getElementById('detail-view').dataset.currentPostId;
                const post = State.posts.find(p => p.id == currentId);
                if(post) {
                    post.comments.unshift({
                        user: State.currentUser, text: box.value, likes: 0, timestamp: Date.now(), id: Math.random(), isLiked: false
                    });
                    showDetail(post.id);
                }
                return;
            }

            if(el.closest('.modal-close')) {
                document.getElementById(el.closest('.modal-close').dataset.target).style.display = 'none';
                return;
            }

            const nav = el.closest('.nav-btn');
            if(nav && !nav.id) {
                document.querySelectorAll('.nav-btn').forEach(n=>n.classList.remove('active'));
                nav.classList.add('active');
                renderList(nav.dataset.cat);
                detailView.style.display='none'; listView.style.display='block';
                return;
            }

            if(el.closest('#btn-back')) { detailView.style.display='none'; listView.style.display='block'; return; }

            // Â∏ñÂ≠êÁÇπËµû
            const like = el.closest('.btn-like');
            if(like) {
                const p = State.posts.find(x=>x.id == like.dataset.pid);
                if(p) {
                    if (p.isLiked) { p.likes--; p.isLiked = false; like.classList.remove('liked'); } 
                    else { p.likes++; p.isLiked = true; like.classList.add('liked'); AudioSys.success(); }
                    const numSpan = like.querySelector('.like-num');
                    if(numSpan) numSpan.innerText = p.likes;
                }
                return;
            }

            // ËØÑËÆ∫ÁÇπËµû (New in V12)
            const cLike = el.closest('.btn-comment-like');
            if(cLike) {
                const pid = cLike.dataset.pid;
                const cid = cLike.dataset.cid;
                const post = State.posts.find(p => p.id == pid);
                if(post) {
                    const c = post.comments.find(c => c.id == cid);
                    if(c) {
                        if(c.isLiked) { c.likes--; c.isLiked = false; cLike.classList.remove('liked'); }
                        else { c.likes++; c.isLiked = true; cLike.classList.add('liked'); AudioSys.success(); }
                        cLike.querySelector('.c-like-num').innerText = c.likes;
                    }
                }
                return;
            }

            const card = el.closest('.post-card');
            if(card) {
                document.getElementById('detail-view').dataset.currentPostId = card.dataset.id;
                showDetail(card.dataset.id);
            }
        }

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5});
        hands.onResults(onResults);
        const cam = new Camera(document.querySelector('.input_video'), {
            onFrame: async () => await hands.send({image: document.querySelector('.input_video')}),
            width: 1280, height: 720
        });
        cam.start();
    </script>
</body>
</html>
